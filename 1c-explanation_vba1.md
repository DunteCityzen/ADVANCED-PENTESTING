# First MSFVENOM generated VBA Macro Explanation

This code gets flagged immediately by AV as seen when you add this macro to a word document, save it as a macro-enabled-document, then upload the document into virustotal.
Virus total goes ahead to tell you by use of tags the suspects that caused this vba to be flagged as malicious by AVs.

## Breaking Down:
the VBA code imports three functions form kernel32.dll:
1. CreateThread - which is used to create a process thread for the code to run.
2. VirtualAlloc - which is used to allocate memory for the shellcode to run.
3. RtlMoveMemory - which is used to move the shellcode into the allocated memory.

Use of auto-open to automatically run the macro whenever a user accepts to enable the content is very suspicious to AV and malware detection software. This also causes this VBA macro to be flagged as malicious by a huge number of AVs.

The use of auto-open and autoopen, one is for docs and another for excel, means that this macro is designed to run regardless of whether it's enabled on a docs file or an excel spreadsheet. This is pretty suspicious as it is expected that the developer of the macro knows the environment it's going to run on.

There's no need for these functions to be used in a word or excel macro let alone importation from kernel32.dll. They are also widely known for executing shellcode and for these reasons, do they hardliy get a chance to sneak a quick one past any decent AV out there in wild.

The fact that shellcode appears in the macro is also very suspicious and will automatically trigger AV. An attacker could try and obsfucate the shell code by maybe encoding it and decoding it in runtime but some AVs can still pick up on this. How? Most AVs these days have the ability to run code on a sandbox environment to see what the shell code does. This beats any attempts to obsfucate the shell code so it is still bound to be caught by AV. This only means that, despite AV not being able to scan the declaration part of the code -- hence the use of aliases to try and bypass AV detection -- they are still able to catch onto this macro's malicious intent.

Yeah, AVs are very ruthless when it comes to Macros. That's why dual staggers are used. To get the job done while still ensuring that AV is happy. How, by use of a VBA/VBS dual stagger, we can bypass some of these AV restrictions.
